---
title: "narra"
date: 2020-01-30T00:38:25+09:00
description: сервис OAuth2 авторизации для учетных записей gitea, используемый для ограничения доступа к приватным ресурсам
draft: false
enableToc: false
weight: 6
---

 Github |  [narra](https://github.com/dopos/narra)
 -- | --
 Назначение | сервис OAuth2 авторизации для учетных записей gitea, используемый для ограничения доступа к приватным ресурсам
 Использование | [в составе dcape](https://dopos.github.io/dcape/baseapps/narra/)
 Docker | [dopos/narra](https://hub.docker.com/r/dopos/narra)

Сервис **narra** создавался как составная часть проекта [dcape](https://dopos.github.io/dcape/) и они вместе с 2017 г находятся в продакшене. Описание работы с **narra** включено в [документацию dcape](https://dopos.github.io/dcape/baseapps/narra/).

В **dcape** v1 для ограничения доступа к внутренним ресурсам использовался **nginx auth_request**, функционал которого реализован в **narra** и дал три первые буквы в название проекта.

В **dcape** v2 для этих задач используется **traefik forward-auth** и необходимый для этого функционал OAuth2 прокси был добавлен в **narra**.

Причина, по которой **narra** был доработан, а не заменен на сторонний сервис вроде [этого](https://github.com/thomseddon/traefik-forward-auth), заключалась в необходимости разрешить доступ не просто зарегистрированному пользователю, а только пользователю, включенному в заданную группу, и OAuth2 прокси с поддержкой такого функционала к ноябрю 2020г найдено не было.

Кроме этого, в проект был добавлен HTTP-сервер для публичной и приватной статики (что позволило в базовой конфигурации **dcape** отказаться от **nginx**).
